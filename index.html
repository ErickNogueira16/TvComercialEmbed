<!DOCTYPE html>
<html lang="pt-BR">
<head>
ย <meta charset="UTF-8">
ย <title>Raizz Capital - TV Comercial</title>
ย <link rel="icon" href="https://raizzcapital.com.br/wp-content/uploads/2024/02/logo-raizz-capital-fundo-branco.webp">
ย <script src="https://public.tableau.com/javascripts/api/tableau.embedding.3.latest.min.js"></script>
ย <style>
ย ย html, body {
ย ย ย margin: 0;
ย ย ย padding: 0;
ย ย }
ย ย #vizContainer {
ย ย ย width: 100%;
ย ย ย height: 100vh;
ย ย }
ย </style>
</head>
<body>
ย <div id="vizContainer"></div>

ย <script>
ย ย const backendURL = "https://tableau-backend-h83x.onrender.com/get_tableau_url";
ย ย const dashboardNames = ["COMERCIAL | ITAJAร", "COMERCIAL | VIANA"];
ย ย const tempoPorPainel = 60000; // 1 min
ย ย let viz, currentDashboardIndex = 0;

ย ย async function initViz() {
ย ย ย try {
ย ย ย ย // 1๏ธโฃ Chama o backend para pegar URL autenticada
ย ย ย ย const resp = await fetch(backendURL);
ย ย ย ย const data = await resp.json();

ย ย ย ย if (data.error) {
ย ย ย ย ย console.error("Erro ao obter URL:", data.error);
ย ย ย ย ย return;
ย ย ย ย }

ย ย ย ย const url = data.embed_url;
ย ย ย ย console.log("โ URL autenticada recebida:", url);

ย ย ย ย // 2๏ธโฃ Cria o elemento <tableau-viz> e adiciona ao container
ย ย ย ย const container = document.getElementById("vizContainer");
ย ย ย ย container.innerHTML = ""; // limpa se jรก existir

ย ย ย ย const vizElement = document.createElement("tableau-viz");
ย ย ย ย vizElement.src = url;
ย ย ย ย vizElement.toolbar = "hidden";
ย ย ย ย vizElement.hideTabs = true;
ย ย ย ย vizElement.style.width = "100%";
ย ย ย ย vizElement.style.height = "100vh";
ย ย ย ย container.appendChild(vizElement);

ย ย ย ย viz = vizElement;

ย ย ย ย // 3๏ธโฃ Inicia rotaรงรฃo automรกtica
ย ย ย ย setInterval(trocarPainel, tempoPorPainel);
ย ย ย ย setTimeout(() => location.reload(true), 15 * 60 * 1000); // recarrega a cada 15 min
ย ย ย } catch (error) {
ย ย ย ย console.error("โ Erro ao inicializar:", error);
ย ย ย }
ย ย }

ย ย async function trocarPainel() {
ย ย ย try {
ย ย ย ย const nextDashboard = dashboardNames[currentDashboardIndex];
ย ย ย ย console.log("๐ Alternando para:", nextDashboard);
ย ย ย ย currentDashboardIndex = (currentDashboardIndex + 1) % dashboardNames.length;

ย ย ย ย // Sรณ funciona se os nomes forem exatamente iguais aos do Tableau
ย ย ย ย const workbook = await viz.workbook;
ย ย ย ย await workbook.activateSheetAsync(nextDashboard);
ย ย ย } catch (error) {
ย ย ย ย console.warn("Erro ao trocar painel:", error.message);
ย ย ย }
ย ย }

ย ย initViz();
ย </script>
</body>
</html>

